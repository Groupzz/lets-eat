<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!---Title of webpage--->
    <title><%=title%> <%=searchTerm%></title>
    <link rel='stylesheet'  href='/fonts/font-awesome-4.7.0/css/font-awesome.min.css'>
    <link rel='stylesheet' href='/stylesheets/yelpSearchPage.css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!--    <script src="http://maps.googleapis.com/maps/api/js"></script>-->
    <script>
        var used = [], i;
        var name = document.getElementById('restName');
        var loc = document.getElementById('restLoc');
        var parent = document.getElementsByClassName('restEle');

        function newRestaurant() {
            if (used.length <= <%=restaurants.length%>) {
                i = (Math.random() * <%= restaurants.length %>) | 0;
                while (used.includes(i)) {
                    i = (Math.random() * <%= restaurants.length %>) | 0;
                }
                console.log(i);
                used.push(i);
            } else {
                console.log("No more");
            }
                <!--var -->
                // while (used.includes(i)) {
                <!--    i = (Math.random() * parseInt(%=restaurants.length%)) | 0;-->
                // }
                <!--parent.id = JSON.stringify(%=restaurants[i].id%);-->
                <!--name.innerText = JSON.stringify(%=restaurants[i].name%)+" - "+JSON.stringify(%=restaurants[i].price%);-->
                <!--loc.innerText = JSON.stringify(%=restaurants[i].location.city%)+","+JSON.stringify(%=restaurants[i].location.state%)+" "+JSON.stringify(%=restaurants[i].location.zip_code%);-->
                // used.push(i);
            // }
            // else {
            //     parent.id = "Done";
            //     name.innerText = "Do a new search request!";
            //     loc.innerText = "---";
            // }
        }

        newRestaurant();

        var reslat,reslng;
        // Functions
        function yelpSite() {
            window.open('https://www.yelp.com/');
        }
        function loginSec() {
            window.location.href = "/login";
        }
        function signUpSec() {
            window.location.href = "/register";
        }
        function aboutUsSec() {
            window.location.href = "/aboutUs";
        }
        function home() {
            window.location.href = "/home";
        }
        function helpSec() {
            window.location.href = "/help";
        }
        function account() {
            window.location.href = '/accountInterface';
        }
        function logoff() {
            window.location.href = '/logout';
        }
        // function initialize() {
        //     var mapProp = {
        //         center:new google.maps.LatLng(33.871038, -117.99275),
        //         zoom:5,
        //         mapTypeId:google.maps.MapTypeId.ROADMAP
        //     };
        //     var map=new google.maps.Map(document.getElementById("map"), mapProp);
        // }
        // var map;
        // function initMap() {
        //     map = new google.maps.Map(document.getElementById('map'), {
        //         center: {lat: 33.862770, lng: -118.002518},
        //         zoom: 8
        //     });
        // }
        // google.maps.event.addDomListener(window, 'load', initMap);
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        /*var map, infoWindow;
        var positions;
        var dest;
        var marker;
        function initMap() {
            var directionsService = new google.maps.DirectionsService();
            var directionsRenderer = new google.maps.DirectionsRenderer();
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -34.397, lng: 150.644},
                zoom: 6
            });
            infoWindow = new google.maps.InfoWindow;
            // replace with restaurant's lat and lng
            var pos = {
                lat: %=posses[i].position.lat%,
                lng: %=posses[i].position.lng%
            }
            marker = new google.maps.Marker({position: pos, map: map});

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    positions = pos;
                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Location found.');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
            directionsRenderer.setMap(map);

            var onChangeHandler = function() {
                calculateAndDisplayRoute(directionsService, directionsRenderer);
            };
            document.getElementById('refresh').addEventListener('click', onChangeHandler);
        }

        function calculateAndDisplayRoute(directionsService, directionsRenderer) {
            console.log("on directions", dest);
            marker.setMap(null);
            directionsService.route(
                {
                    origin: { lat: positions.lat,
                        lng: positions.lng},
                    destination: {lat: dest.lat,
                        lng: dest.lng
                    },
                    travelMode: 'DRIVING'
                },
                function(response, status) {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });

        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }*/
    </script>
</head>
<body> <!--onload="initMap()">-->
<div class="wrapper">
    <div class = "top">
        <div class="top_image">
            <img src="/images/logo2.gif" alt="Avatar" class = "round-image" onclick = "home()">
        </div>
        <!--        <div id="searchBarContainer">-->
        <!--            <form>-->
        <!--                <input class="searchBar" type="search" name="search" placeholder="Deliciousness is just a click away.....">-->
        <!--            </form>-->
        <!--        </div>-->
        <%if(userInfo!=null){%>
            <div class="dropdown">
                <button class="dropbtn"><i class="fa fa-user-circle-o fa-3x" aria-hidden="false"></i>
                </button>
                <div class="dropdown-content">
                    <p style="font-size: large; margin-top: 15px; margin-bottom: 0px">Hello, <%=un%></p>
                    <li onclick="account()">My Account</li>
                    <li onclick = "groupVoteSec()">Group Vote</li>
                    <li onclick = "advancedSearch()">Advanced Search</li>
                    <li onclick="aboutUsSec()">About Us</li>
                    <li onclick="helpSec()">Help</li>
                    <li onclick="yelpSite()">Yelp</li>
                    <li onclick="logoff()">Log Out</li>
                </div>
            </div>
        <%}else{%>
            <div class="dropdown">
                <button class="dropbtn"><i class="fa fa-user-circle-o fa-3x" aria-hidden="false"></i>
                </button>
                <div class="dropdown-content">
                    <li onclick="loginSec()">Log In</li>
                    <li onclick = "signUpSec()">Sign Up</li>
                    <li onclick = "groupVoteSec()">Group Vote</li>
                    <li onclick = "advancedSearch()">Advanced Search</li>
                    <li onclick="aboutUsSec()">About Us</li>
                    <li onclick="helpSec()">Help</li>
                    <li onclick="yelpSite()">Yelp</li>
                </div>
            </div>
        <%}%>
    <div class="container">

        <div class="restaurantListContainer" id="restCon">
            <div class="restEle">
                <span class="name" id="restName"><%=restaurants[0].name%> - <%=restaurants[0].price%></span><span class="location" id="restLoc"></span>
            </div>
            <div class="mapcontainer">
                <div id="map"></div>
            </div>

        </div>
        <div class="refreshContainer">
            <input type="button" value="New Restaurant" class ="refreshButton" id="refresh" onclick="newRestaurant()">
        </div>

<!--        <script async defer-->
<!--                src="https://maps.googleapis.com/maps/api/js?key=GOOGLE-API&callback=initMap">-->
<!--        </script>-->
    </div>
</div>
</body>
</html>